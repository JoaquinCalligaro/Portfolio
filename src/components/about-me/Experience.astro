---
import TimelineItem from './TimelineItem.astro';
import { getExperiences, getAboutMe } from '../../data/translations';
import Education from '../icons/Education.astro';
const rawExperiences = getExperiences('ES');
const t = getAboutMe('ES');
import '../../styles/about.css';
const EXPERIENCES = rawExperiences;
---

<div
  class="about-card-root mt-10 mb-5 flex-1 rounded-xl border border-transparent bg-gray-100/30 p-5 px-10 transition-all duration-300 hover:-translate-y-1 hover:border-cyan-400/30 hover:shadow-lg dark:bg-gray-900/30 dark:hover:border-cyan-400/50"
>
  <h3
    class="mb-6 flex items-center gap-2 text-lg font-semibold text-gray-950 sm:text-xl dark:text-white"
  >
    <span data-i18n-key="aboutMe.experience.heading"
      >{t.experience.heading}</span
    >
    <Education class="h-6 w-6" />
  </h3>
  <ol class="relative border-s-2 border-gray-300 dark:border-neutral-700">
    {
      EXPERIENCES.map((experience) => (
        <TimelineItem
          title={experience.company}
          description={experience.description}
          date={experience.dates}
        />
      ))
    }
  </ol>
  <script is:inline>
    (function () {
      const ol = document.currentScript?.previousElementSibling;
      if (!ol || !ol.querySelector) return;
      // Client-side icon map - expandible para m√°s tipos
      const icons = {
        university: `
<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 491.52 491.52" xml:space="preserve"><g stroke-width="0"/><g stroke-linecap="round" stroke-linejoin="round"/><path style="fill:#64798a" d="m244.372 153.895-98.806-28.36v48.882c8.489 3.514 14.467 11.861 14.467 21.618 0 6.615-2.768 12.56-7.178 16.817l6.601 36.108c27.868 9.727 54.834 17.458 80.413 22.122 3.507.64 7.094.627 10.6-.02 48.76-8.991 100.63-26.604 154.824-50.644 12.262-5.439 19.509-18.238 17.818-31.544-3.602-28.327-13.905-54.531-29.157-77.116L247.15 153.894a5.04 5.04 0 0 1-2.778.001m-131.15 42.14c0-9.758 5.981-18.106 14.47-21.618v-54.011l-30.157-8.657c-15.203 22.509-25.483 48.616-29.119 76.831-1.726 13.399 5.652 26.296 18.054 31.648 10.179 4.393 20.257 8.564 30.278 12.605l3.653-19.981c-4.411-4.257-7.179-10.202-7.179-16.817"/><path style="fill:#2f4859" d="m487.874 78.963-240.726 69.094a5 5 0 0 1-2.777 0l-93.549-26.849-5.257 2.042v2.286l98.806 28.36a5.04 5.04 0 0 0 2.777 0l146.804-42.136 93.922-26.958c3.64-1.045 4.552-5.166 2.741-7.757-.606.87-1.518 1.567-2.741 1.918m-360.182 38.168c0-.847.148-1.667.376-2.456L3.644 78.963c-1.221-.351-2.133-1.048-2.739-1.918-1.812 2.591-.899 6.712 2.739 7.757l93.89 26.948 30.157 8.657z"/><path style="fill:#3a556a" d="m3.644 78.963 124.423 35.712c.756-2.64 2.677-4.848 5.323-5.869l89.344-34.711c.026-8.21 10.323-14.865 23.026-14.865 12.72 0 23.031 6.671 23.031 14.896 0 8.227-10.311 14.895-23.031 14.895-3.204 0-6.252-.425-9.023-1.19l-85.915 33.377 93.549 26.849a5 5 0 0 0 2.777 0l240.726-69.094c1.223-.351 2.134-1.048 2.741-1.918 1.811-2.59.899-6.712-2.741-7.755L247.149.195a5.04 5.04 0 0 0-2.777 0L3.644 69.289C.005 70.333-.907 74.454.905 77.044c.607.871 1.518 1.568 2.739 1.919"/><path style="fill:#e56353" d="m222.728 74.126.005-.031-89.344 34.711c-2.646 1.021-4.567 3.229-5.323 5.869-.227.789-.376 1.609-.376 2.456v57.286a23.3 23.3 0 0 1 8.935-1.786c3.169 0 6.183.645 8.939 1.786v-51.168l5.257-2.042 85.915-33.377c-8.233-2.269-14.008-7.549-14.008-13.704"/><path style="fill:#2f4859" d="M236.737 87.83c2.772.765 5.819 1.19 9.023 1.19 12.72 0 23.031-6.668 23.031-14.895 0-8.225-10.311-14.896-23.031-14.896-12.703 0-23 6.655-23.026 14.865l-.005.031c-.001 6.156 5.774 11.436 14.008 13.705"/><path style="fill:#e56353" d="M136.626 219.442c-6.312 0-12.015-2.527-16.226-6.589l-3.653 19.981-12.995 71.075h65.75l-10.048-54.947-6.601-36.108c-4.21 4.06-9.914 6.588-16.227 6.588"/><path style="fill:#d15241" d="M127.692 174.417c-8.489 3.512-14.47 11.86-14.47 21.618 0 6.615 2.768 12.56 7.178 16.817 4.211 4.062 9.914 6.589 16.226 6.589 6.313 0 12.017-2.527 16.227-6.589 4.411-4.257 7.178-10.202 7.178-16.817 0-9.757-5.978-18.103-14.467-21.618a23.3 23.3 0 0 0-8.939-1.786 23.3 23.3 0 0 0-8.933 1.786"/><path style="fill:#ebf0f3" d="m196.829 396.23 5.693-5.692-4.025-6.972 6.971-4.025-2.083-7.777 7.775-2.083v-8.05h8.051l1.777-6.631v-19.615H0v64.167h200.152zm73.701-41.233 1.779 6.634h8.05v8.05l7.775 2.083-2.083 7.777 6.972 4.025-4.025 6.972 5.692 5.692-3.322 3.322H491.52v-64.167H270.53z"/><path style="fill:#e1e6e9" d="m288.998 401.923 4.025 6.972-6.972 4.026 2.083 7.775-7.775 2.083v1.578H491.52v-24.805H291.368zm-85.613 18.773 2.083-7.775-6.971-4.026 4.025-6.972-2.37-2.371H0v24.805h211.16v-1.578z"/><path style="fill:#e56353" d="m262.449 436.523-2.28 3.949-1.745 3.022-6.972-4.025-3.752 3.752-1.941 1.939-1.94-1.939-3.752-3.752-6.971 4.025-1.746-3.021-2.28-3.95-7.776 2.083-.306-1.144v54.058l24.772-17.733 24.77 17.733v-54.056l-.304 1.142zm-41.155-82.667 7.776 2.081 4.026-6.97 6.971 4.026 5.692-5.693 5.693 5.693 6.972-4.026 4.025 6.97 7.777-2.081.304 1.141v-19.612h-49.542V355z"/><path style="fill:#fcd462" d="m288.134 420.696-2.083-7.775 6.973-4.026-4.026-6.972 2.371-2.371 3.322-3.322-5.692-5.692 4.026-6.972-6.973-4.025 2.083-7.777-7.775-2.083v-8.05h-8.05l-1.779-6.634-.304-1.141-7.777 2.081-4.025-6.97-6.973 4.026-5.692-5.693-5.692 5.693-6.971-4.026-4.026 6.97-7.776-2.081-.307 1.144-1.777 6.632h-8.051v8.05l-7.775 2.083 2.083 7.777-6.971 4.025 4.025 6.972-5.692 5.692 3.323 3.322 2.369 2.371-4.025 6.972 6.971 4.026-2.083 7.775 7.775 2.084v8.05h8.051l1.054 3.935.723 2.697.306 1.144 7.776-2.083 2.28 3.95 1.746 3.021 6.971-4.025 3.752 3.752 1.941 1.939 1.941-1.939 3.752-3.752 6.973 4.025 1.745-3.022 2.28-3.949 7.777 2.083.304-1.142.724-2.699 1.054-3.935h8.05v-8.05zm-42.373 10.635c-19.355 0-35.101-15.746-35.101-35.101s15.746-35.101 35.101-35.101 35.099 15.747 35.099 35.101c0 19.356-15.744 35.101-35.099 35.101"/><circle style="fill:#fcd462" cx="245.76" cy="396.237" r="29.88"/><path style="fill:#e56353" d="M280.86 396.23c0-19.354-15.744-35.101-35.099-35.101s-35.101 15.747-35.101 35.101c0 19.355 15.746 35.101 35.101 35.101s35.099-15.745 35.099-35.101m-64.98 0c0-16.477 13.404-29.881 29.881-29.881s29.88 13.404 29.88 29.881c0 16.476-13.402 29.881-29.88 29.881-16.477 0-29.881-13.405-29.881-29.881"/></svg>
`,
        work: `
<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0H8m8 0v2a2 2 0 002 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2v-8a2 2 0 012-2V8a2 2 0 002-2z" />
</svg>
`,
        certificate: `
<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
</svg>
`,
        default: `
<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
</svg>
`,
      };

      // Ya no necesitamos mapeo por nombre de empresa - usamos iconKey directamente

      function buildList(lang) {
        try {
          const data =
            (window.TRANSLATIONS &&
              window.TRANSLATIONS[lang] &&
              window.TRANSLATIONS[lang].experiences) ||
            [];
          // Clear
          ol.innerHTML = '';
          // Aqui se editan los estilos de educacion
          for (const exp of data) {
            const li = document.createElement('li');
            li.className = 'ms-8 mb-10';

            const span = document.createElement('span');
            span.className =
              'absolute -start-3 flex size-6 items-center justify-center rounded-full bg-blue-300 ring-8 ring-blue-100 dark:bg-blue-800 dark:ring-blue-950/60';

            const key = exp.iconKey || 'default'; // Usa iconKey de la data o fallback
            span.innerHTML = icons[key] || icons.default;

            const h3 = document.createElement('h3');
            h3.className =
              'mb-1 flex items-center text-lg font-semibold text-gray-950 dark:text-white';
            h3.textContent = exp.company || '';

            const time = document.createElement('time');
            time.className =
              'mb-2 block text-sm leading-none font-semibold dark:text-cyan-400 text-cyan-700';
            time.textContent = exp.dates || '';

            const p = document.createElement('p');
            p.className =
              'mb-4 text-sm font-normal text-black sm:text-base dark:text-white';
            p.textContent = exp.description || '';

            li.appendChild(span);
            li.appendChild(h3);
            li.appendChild(time);
            li.appendChild(p);

            ol.appendChild(li);
          }
        } catch {
          //Empty
        }
      }

      window.addEventListener('langChange', (ev) => {
        const lang = (ev && ev.detail) || document.documentElement.lang || 'ES';
        buildList(lang);
      });

      // initial
      buildList(document.documentElement.lang || 'ES');
    })();
  </script>
</div>

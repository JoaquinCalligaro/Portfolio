---
import TimelineItem from './TimelineItem.astro';
import { getExperiences, getAboutMe } from '../../data/translations';
import Education from '../icons/Education.astro';
import '../../styles/about.css';
const rawExperiences = getExperiences('ES');
const t = getAboutMe('ES');
const EXPERIENCES = rawExperiences;
---

<div
  class="about-card-root rounded-xl bg-gray-100/30 p-6 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg dark:bg-gray-900/30"
>
  <div class="about-card-inner">
    <h3
      class="mb-6 flex items-center gap-2 text-lg font-semibold text-gray-950 sm:text-xl dark:text-white"
    >
      <span data-i18n-key="aboutMe.experience.heading"
        >{t.experience.heading}</span
      >
      <Education class="h-6 w-6" />
    </h3>

    <ol class="relative border-s-2 border-gray-300 dark:border-neutral-700">
      {
        EXPERIENCES.map((experience) => (
          <TimelineItem
            title={experience.company}
            description={experience.description}
            date={experience.dates}
          />
        ))
      }
    </ol>

    <script is:inline>
      (function () {
        const ol = document.currentScript?.previousElementSibling;
        if (!ol || !ol.querySelector) return;
        const icons = {
          university: `
<svg height="64" width="64" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 491.52 491.52" xml:space="preserve"><g stroke-width="0"/><g stroke-linecap="round" stroke-linejoin="round"/><path style="fill:#64798a" d="m244.372 153.895-98.806-28.36v48.882c8.489 3.514 14.467 11.861 14.467 21.618 0 6.615-2.768 12.56-7.178 16.817l6.601 36.108c27.868 9.727 54.834 17.458 80.413 22.122 3.507.64 7.094.627 10.6-.02 48.76-8.991 100.63-26.604 154.824-50.644 12.262-5.439 19.509-18.238 17.818-31.544-3.602-28.327-13.905-54.531-29.157-77.116L247.15 153.894a5.04 5.04 0 0 1-2.778.001m-131.15 42.14c0-9.758 5.981-18.106 14.47-21.618v-54.011l-30.157-8.657c-15.203 22.509-25.483 48.616-29.119 76.831-1.726 13.399 5.652 26.296 18.054 31.648 10.179 4.393 20.257 8.564 30.278 12.605l3.653-19.981c-4.411-4.257-7.179-10.202-7.179-16.817"/><path style="fill:#2f4859" d="m487.874 78.963-240.726 69.094a5 5 0 0 1-2.777 0l-93.549-26.849-5.257 2.042v2.286l98.806 28.36a5.04 5.04 0 0 0 2.777 0l146.804-42.136 93.922-26.958c3.64-1.045 4.552-5.166 2.741-7.757-.606.87-1.518 1.567-2.741 1.918m-360.182 38.168c0-.847.148-1.667.376-2.456L3.644 78.963c-1.221-.351-2.133-1.048-2.739-1.918-1.812 2.591-.899 6.712 2.739 7.757l93.89 26.948 30.157 8.657z"/><path style="fill:#3a556a" d="m3.644 78.963 124.423 35.712c.756-2.64 2.677-4.848 5.323-5.869l89.344-34.711c.026-8.21 10.323-14.865 23.026-14.865 12.72 0 23.031 6.671 23.031 14.896 0 8.227-10.311 14.895-23.031 14.895-3.204 0-6.252-.425-9.023-1.19l-85.915 33.377 93.549 26.849a5 5 0 0 0 2.777 0l240.726-69.094c1.223-.351 2.134-1.048 2.741-1.918 1.811-2.59.899-6.712-2.741-7.755L247.149.195a5.04 5.04 0 0 0-2.777 0L3.644 69.289C.005 70.333-.907 74.454.905 77.044c.607.871 1.518 1.568 2.739 1.919"/><path style="fill:#e56353" d="m222.728 74.126.005-.031-89.344 34.711c-2.646 1.021-4.567 3.229-5.323 5.869-.227.789-.376 1.609-.376 2.456v57.286a23.3 23.3 0 0 1 8.935-1.786c3.169 0 6.183.645 8.939 1.786v-51.168l5.257-2.042 85.915-33.377c-8.233-2.269-14.008-7.549-14.008-13.704"/><path style="fill:#2f4859" d="M236.737 87.83c2.772.765 5.819 1.19 9.023 1.19 12.72 0 23.031-6.668 23.031-14.895 0-8.225-10.311-14.896-23.031-14.896-12.703 0-23 6.655-23.026 14.865l-.005.031c-.001 6.156 5.774 11.436 14.008 13.705"/>
  `,
          nocountry: `
<svg height="64" width="64" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 491.52 491.52" xml:space="preserve"><g stroke-width="0"/><g stroke-linecap="round" stroke-linejoin="round"/><path style="fill:#64798a" d="m244.372 153.895-98.806-28.36v48.882c8.489 3.514 14.467 11.861 14.467 21.618 0 6.615-2.768 12.56-7.178 16.817l6.601 36.108c27.868 9.727 54.834 17.458 80.413 22.122 3.507.64 7.094.627 10.6-.02 48.76-8.991 100.63-26.604 154.824-50.644 12.262-5.439 19.509-18.238 17.818-31.544-3.602-28.327-13.905-54.531-29.157-77.116L247.15 153.894a5.04 5.04 0 0 1-2.778.001m-131.15 42.14c0-9.758 5.981-18.106 14.47-21.618v-54.011l-30.157-8.657c-15.203 22.509-25.483 48.616-29.119 76.831-1.726 13.399 5.652 26.296 18.054 31.648 10.179 4.393 20.257 8.564 30.278 12.605l3.653-19.981c-4.411-4.257-7.179-10.202-7.179-16.817"/><path style="fill:#2f4859" d="m487.874 78.963-240.726 69.094a5 5 0 0 1-2.777 0l-93.549-26.849-5.257 2.042v2.286l98.806 28.36a5.04 5.04 0 0 0 2.777 0l146.804-42.136 93.922-26.958c3.64-1.045 4.552-5.166 2.741-7.757-.606.87-1.518 1.567-2.741 1.918m-360.182 38.168c0-.847.148-1.667.376-2.456L3.644 78.963c-1.221-.351-2.133-1.048-2.739-1.918-1.812 2.591-.899 6.712 2.739 7.757l93.89 26.948 30.157 8.657z"/><path style="fill:#3a556a" d="m3.644 78.963 124.423 35.712c.756-2.64 2.677-4.848 5.323-5.869l89.344-34.711c.026-8.21 10.323-14.865 23.026-14.865 12.72 0 23.031 6.671 23.031 14.896 0 8.227-10.311 14.895-23.031 14.895-3.204 0-6.252-.425-9.023-1.19l-85.915 33.377 93.549 26.849a5 5 0 0 0 2.777 0l240.726-69.094c1.223-.351 2.134-1.048 2.741-1.918 1.811-2.59.899-6.712-2.741-7.755L247.149.195a5.04 5.04 0 0 0-2.777 0L3.644 69.289C.005 70.333-.907 74.454.905 77.044c.607.871 1.518 1.568 2.739 1.919"/><path style="fill:#e56353" d="m222.728 74.126.005-.031-89.344 34.711c-2.646 1.021-4.567 3.229-5.323 5.869-.227.789-.376 1.609-.376 2.456v57.286a23.3 23.3 0 0 1 8.935-1.786c3.169 0 6.183.645 8.939 1.786v-51.168l5.257-2.042 85.915-33.377c-8.233-2.269-14.008-7.549-14.008-13.704"/><path style="fill:#2f4859" d="M236.737 87.83c2.772.765 5.819 1.19 9.023 1.19 12.72 0 23.031-6.668 23.031-14.895 0-8.225-10.311-14.896-23.031-14.896-12.703 0-23 6.655-23-..."/>
  `,
          gotosend: `
<svg height="64" width="64" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 491.52 491.52" xml:space="preserve"><g stroke-width="0"/><g stroke-linecap="round" stroke-linejoin="round"/><path style="fill:#64798a" d="m244.372 153.895-98.806-28.36v48.882c8.489 3.514 14.467 11.861 14.467 21.618 0 6.615-2.768 12.56-7.178 16.817l6.601 36.108c27.868 9.727 54.834 17.458 80.413 22.122 3.507.64 7.094.627 10.6-.02 48.76-8.991 100.63-26.604 154.824-50.644 12.262-5.439 19.509-18.238 17.818-31.544-3.602-28.327-13.905-54.531-29.157-77.116L247.15 153.894a5.04 5.04 0 0 1-2.778.001m-131.15 42.14c0-9.758 5.981-18.106 14.47-21.618v-54.011l-30.157-8.657c-15.203 22.509-25.483 48.616-29.119 76.831-1.726 13.399 5.652 26.296 18.054 31.648 10.179 4.393 20.257 8.564 30.278 12.605l3.653-19.981c-4.411-4.257-7.179-10.202-7.179-16.817"/><path style="fill:#2f4859" d="m487.874 78.963-240.726 69.094a5 5 0 0 1-2.777 0l-93.549-26.849-5.257 2.042v2.286l98.806 28.36a5.04 5.04 0 0 0 2.777 0l146.804-42.136 93.922-26.958c3.64-1.045 4.552-5.166 2.741-7.757-.606.87-1.518 1.567-2.741 1.918m-360.182 38.168c0-.847.148-1.667.376-2.456L3.644 78.963c-1.221-.351-2.133-1.048-2.739-1.918-1.812 2.591-.899 6.712 2.739 7.757l93.89 26.948 30.157 8.657z"/><path style="fill:#3a556a" d="m3.644 78.963 124.423 35.712c.756-2.64 2.677-4.848 5.323-5.869l89.344-34.711c.026-8.21 10.323-14.865 23.026-14.865 12.72 0 23.031 6.671 23.031 14.896 0 8.227-10.311 14.895-23.031 14.895-3.204 0-6.252-.425-9.023-1.19l-85.915 33.377 93.549 26.849a5 5 0 0 0 2.777 0l240.726-69.094c1.223-.351 2.134-1.048 2.741-1.918 1.811-2.59.899-6.712-2.741-7.755L247.149.195a5.04 5.04 0 0 0-2.777 0L3.644 69.289C.005 70.333-.907 74.454.905 77.044c.607.871 1.518 1.568 2.739 1.919"/><path style="fill:#e56353" d="m222.728 74.126.005-.031-89.344 34.711c-2.646 1.021-4.567 3.229-5.323 5.869-.227.789-.376 1.609-.376 2.456v57.286a23.3 23.3 0 0 1 8.935-1.786c3.169 0 6.183.645 8.939 1.786v-51.168l5.257-2.042 85.915-33.377c-8.233-2.269-14.008-7.549-14.008-13.704"/><path style="fill:#2f4859" d="M236.737 87.83c2.772.765 5.819 1.19 9.023 1.19 12.72 0 23.031-6.668 23.031-14.895 0-8.225-10.311-14.896-23.031-14.896-12.703 0-23 6.655-23.026 14.865l-.005.031c-.001 6.156 5.774 11.436 14.008 13.705"/>
  `,
        };

        const companyIconMap = {
          'University of CamagÃ¼ey': 'university',
          'No Country Tech Work Simulation': 'nocountry',
          GotoSend: 'gotosend',
        };

        function buildList(lang) {
          try {
            const data =
              (window.TRANSLATIONS &&
                window.TRANSLATIONS[lang] &&
                window.TRANSLATIONS[lang].experiences) ||
              [];
            ol.innerHTML = '';

            for (const exp of data) {
              const li = document.createElement('li');
              li.className = 'ms-8 mb-10';

              const span = document.createElement('span');
              span.className =
                'absolute -start-3 flex size-6 items-center justify-center rounded-full bg-blue-300 ring-8 ring-blue-100 dark:bg-blue-800 dark:ring-blue-950/60';

              const key = companyIconMap[exp.company] || null;
              span.innerHTML = key ? icons[key] || '' : '';

              const h3 = document.createElement('h3');
              h3.className =
                'mb-1 flex items-center text-lg font-semibold text-gray-950 dark:text-white';
              h3.textContent = exp.company || '';

              const time = document.createElement('time');
              time.className =
                'mb-2 block text-sm leading-none font-normal text-cyan-400';
              time.textContent = exp.dates || '';

              const p = document.createElement('p');
              p.className =
                'mb-4 text-sm font-normal text-gray-600 sm:text-base dark:text-white';
              p.textContent = exp.description || '';

              li.appendChild(span);
              li.appendChild(h3);
              li.appendChild(time);
              li.appendChild(p);

              ol.appendChild(li);
            }
          } catch {
            // noop
          }
        }

        window.addEventListener('langChange', (ev) => {
          const lang =
            (ev && ev.detail) || document.documentElement.lang || 'ES';
          buildList(lang);
        });

        // initial
        buildList(document.documentElement.lang || 'ES');
      })();
    </script>
  </div>
</div>

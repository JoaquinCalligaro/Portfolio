---
import '../../styles/contact.css';
import LocalizedText from '../language/LocalizedText.astro';

import SubmitBtn from './SubmitBtn.astro';
import FormStatus from './FormStatus.astro';
import CooldownDisplay from './CooldownDisplay.astro';
import CharacterCounter from './CharacterCounter.astro';
// Formspree action must be provided via env
const FORMSPREE_ACTION = import.meta.env.PUBLIC_FORMSPREE_ACTION;
---

<div
  class="contact-card-root mt-10 mb-20 rounded-xl border border-transparent dark:hover:border-cyan-400/50"
>
  <div class="contact-card-inner p-6">
    <form
      id="contactForm"
      action={FORMSPREE_ACTION}
      method="post"
      class="contact-form w-full space-y-4 rounded-xl"
      novalidate
    >
      <div>
        <label
          for="name"
          class="block text-sm font-medium text-gray-700 dark:text-gray-300"
          ><LocalizedText key="contact.name" /></label
        >
        <input
          id="name"
          name="name"
          type="text"
          required
          maxlength="50"
          aria-describedby="name-error"
          class="mt-1 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm transition-colors duration-150 focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:border-neutral-700 dark:bg-gray-800 dark:text-gray-100"
        />
        <p
          id="name-error"
          class="mt-1 hidden text-sm text-red-600"
          aria-live="polite"
        >
        </p>
      </div>

      <div>
        <label
          for="email"
          class="block text-sm font-medium text-gray-700 dark:text-gray-300"
          ><LocalizedText key="contact.email" /></label
        >
        <input
          id="email"
          name="email"
          type="email"
          required
          class="mt-1 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm transition-colors duration-150 focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:border-neutral-700 dark:bg-gray-800 dark:text-gray-100"
        />
        <p
          id="email-error"
          class="mt-1 hidden text-sm text-red-600"
          aria-live="polite"
        >
        </p>
      </div>

      <div>
        <label
          for="message-editor"
          class="block text-sm font-medium text-gray-700 dark:text-gray-300"
          ><LocalizedText key="contact.message" /></label
        >

        <!-- Toolbar removed: simplified editor -->

        <!-- Editor -->
        <div
          id="message-editor"
          contenteditable="true"
          aria-label="Mensaje"
          role="textbox"
          class="mt-1 min-h-[120px] w-full rounded-md border border-gray-300 bg-white p-3 text-sm shadow-sm transition-colors duration-150 focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:border-neutral-700 dark:bg-gray-800 dark:text-gray-100"
        >
        </div>

        <p
          id="message-error"
          class="mt-1 hidden text-sm text-red-600"
          aria-live="polite"
        >
        </p>

        <!-- Character count indicator for minimum length -->
        <p
          id="message-count"
          class="mt-1 hidden text-sm text-red-600"
          aria-live="polite"
        >
        </p>

        <!-- Character counter component -->
        <CharacterCounter
          id="message-char-counter"
          targetId="message-editor"
          maxLength={1000}
        />

        <!-- Hidden input to submit HTML content -->
        <input type="hidden" id="message" name="message" />
        <!-- Time-trap hidden field (ms spent before submit) -->
        <input type="hidden" id="time_spent" name="time_spent" />
        <!-- Simple form token to make automated submissions harder -->
        <input type="hidden" id="form_token" name="form_token" />
        <!-- Hidden input for message content -->
      </div>

      <!-- Honeypot: bots will fill this; real users won't. Use sr-only for accessibility -->
      <label for="website" class="sr-only">Website</label>
      <input
        id="website"
        name="website"
        type="text"
        autocomplete="off"
        tabindex="-1"
        class="sr-only"
      />

      <div class="w-full text-center">
        <!-- Cooldown display mejorado -->
        <CooldownDisplay id="cooldown-display" />

        <FormStatus id="form-status" />
      </div>

      <div class="flex items-center justify-start gap-3">
        <SubmitBtn id="submit-btn" translationKey="contact.send" />
      </div>
    </form>

    <script type="module" src="/src/components/scripts/contact/contact-form.ts"
    ></script>
  </div>
</div>

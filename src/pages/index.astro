---
// index.astro - Refactorizado usando principalmente Tailwind
import Layout from '../layouts/Layout.astro';
import TechStack from '../components/tech-stack/TechStack.astro';
import PersonalPresentation from '../components/PersonalPresentation.astro';
import ProjectTitle from '../components/my-projects/ProyectsTitle.astro';
import ProjectCard1 from '../components/my-projects/ProjectCard1.astro';
import ProjectCard2 from '../components/my-projects/ProjectCard2.astro';
import ProjectCard3 from '../components/my-projects/ProjectCard3.astro';
import ProjectCard4 from '../components/my-projects/ProjectCard4.astro';
import ProjectCard5 from '../components/my-projects/ProjectCard5.astro';
import ProjectCard6 from '../components/my-projects/ProjectCard6.astro';
import ShowMoreBtn from '../components/ui/ShowMoreBtn.astro';
import AboutMeTitle from '../components/about-me/AboutMeTitle.astro';
import ShortBio from '../components/about-me/ShortBio.astro';
import '../styles/global.css';
import Experience from '../components/about-me/Experience.astro';
import Contact from '../components/contact/Contact.astro';
import ContactTitle from '../components/contact/ContactTitle.astro';
---

<Layout>
  <!-- Sección Hero -->
  <div id="home" class="pt-40">
    <PersonalPresentation />
  </div>
  <section class="flex flex-col">
    <article>
      <!-- Tech Stack  -->
      <div id="tech-stack">
        <TechStack />
      </div>
      <div id="projects">
        <ProjectTitle />
        <div class="mt-12">
          <div class="grid grid-cols-1 gap-15 sm:grid-cols-2 md:grid-cols-2">
            <ProjectCard1 />
            <ProjectCard2 />
            <ProjectCard3 />
            <ProjectCard4 />
          </div>

          <!-- Contenedor oculto con los proyectos adicionales (5 y 6) -->
          <div id="extra-projects" class="mt-8 hidden">
            <div class="grid grid-cols-1 gap-15 sm:grid-cols-2 md:grid-cols-2">
              <ProjectCard5 />
              <ProjectCard6 />
            </div>
          </div>

          <!-- Botón aislado reusable en ui -->
          <div class="flex justify-center">
            <ShowMoreBtn id="show-more-projects" />
          </div>
        </div>
      </div>

      <!-- Sección Sobre Mí -->
      <section id="about" class="py-16">
        <div><AboutMeTitle /></div>
        <div class="mx-auto w-full max-w-6xl">
          <div
            class="flex flex-col gap-8 md:flex-row md:items-start md:space-x-8"
          >
            <div class="md:w-1/2">
              <ShortBio />
            </div>
            <div class="md:w-1/2">
              <Experience />
            </div>
          </div>
        </div>
      </section>
      <section class="py-16" id="contact">
        <div><ContactTitle /></div>
        <div>
          <Contact />
        </div>
      </section>
    </article>
  </section>

  <script>
    import { animate, inView, stagger } from 'motion';

    document.addEventListener('DOMContentLoaded', () => {
      // (services section removed) no-op

      // Animación para tech stack
      inView('.tech-stack-card', () => {
        animate(
          '.tech-card-enter',
          {
            opacity: [0, 1],
            transform: ['translateY(30px)', 'translateY(0px)'],
          },
          {
            delay: stagger(0.1),
            duration: 0.5,
            easing: [0.4, 0, 0.2, 1],
          }
        );
      });

      // Animación para proyectos
      inView('#projects', () => {
        animate(
          '#projects .grid > *',
          {
            opacity: [0, 1],
            transform: ['translateY(40px)', 'translateY(0px)'],
          },
          {
            delay: stagger(0.2),
            duration: 0.6,
            easing: [0.4, 0, 0.2, 1],
          }
        );
      });
    });

    // Inicializar show-more button (usa window.initShowMore o inyecta script desde /js)
    (function ensureInitShowMore() {
      function run() {
        try {
          if (typeof window === 'undefined') return;
          if (!Object.prototype.hasOwnProperty.call(window, 'initShowMore'))
            return;
          const fn = (window as unknown)['initShowMore'];
          if (typeof fn === 'function')
            fn('show-more-projects', {
              targetId: 'extra-projects',
              hiddenClass: 'hidden',
            });
        } catch {
          // noop
        }
      }

      try {
        if (
          typeof window !== 'undefined' &&
          Object.prototype.hasOwnProperty.call(window, 'initShowMore')
        ) {
          run();
          return;
        }
      } catch {
        // noop
      }

      const existing = document.querySelector('script[data-show-more-module]');
      if (existing) {
        existing.addEventListener('load', run);
        return;
      }

      const script = document.createElement('script');
      script.type = 'module';
      script.src = '/js/show-more/show-more-init.js';
      script.setAttribute('data-show-more-module', '');
      script.addEventListener('load', run);
      script.addEventListener('error', () => {});
      document.head.appendChild(script);
    })();
  </script>
</Layout>

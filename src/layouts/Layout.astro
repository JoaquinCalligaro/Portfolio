---
// Layout principal del sitio - estructura base de todas las páginas
import Footer from '../components/Footer.astro';
import GoToTopBtn from '../components/ui/GoToTopBtn.astro';
import Navbar from '../components/navbar/Navbar.astro';
import BackgroundSwitcher from '../components/ui/background/BackgroundSwitcher';

import '../styles/base/global.css';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>Portfolio | Joaquin Calligaro</title>

    <!-- Metas -->
    <meta
      name="description"
      content="A small minimalist web developer portfolio built with Astro and TailwindCSS"
    />
    <!-- Script de inicialización del tema para evitar parpadeo -->
    <script>
      (function () {
        try {
          let stored = null;
          try {
            stored = localStorage.getItem('color-theme');
          } catch (err) {
            console.debug('Unable to read theme from localStorage', err);
            stored = null;
          }
          const prefersDark =
            typeof window !== 'undefined' &&
            window.matchMedia &&
            window.matchMedia('(prefers-color-scheme: dark)').matches;
          const theme = stored || (prefersDark ? 'dark' : 'light');

          if (theme === 'dark') {
            try {
              document.documentElement.classList.add('dark');
            } catch (err) {
              console.debug('Failed to add dark class', err);
            }
            // temporary background avoided: rely on CSS fallback in global.css
          }
        } catch (err) {
          console.debug('Theme initializer error', err);
        }
      })();
    </script>
    <!-- Turnstile script is injected only on pages that need it (Contact.astro) -->
  </head>
  <body class="page-root min-h-screen">
    <!-- Background dinámico dark/light -->
    <BackgroundSwitcher client:only="react" />

    <Navbar />
    <main
      class="relative z-10 mx-auto flex min-h-screen max-w-screen-lg flex-col gap-12 p-6"
    >
      <slot />
    </main>
    <GoToTopBtn />
    <Footer />
  </body>
  <style is:global>
    * {
      scroll-behavior: smooth;
    }
  </style>
</html>
